---
phase: 12-dry-run-mode
plan: 02
type: execute
---

<objective>
Add --dry-run flag to run, queue, and epic commands.

Purpose: Allow users to preview workflow sequences without executing them.
Output: Commands display planned workflows when --dry-run is provided.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-dry-run-mode/12-01-SUMMARY.md

**Key files:**
@internal/cli/run.go
@internal/cli/queue.go
@internal/cli/epic.go
@internal/lifecycle/executor.go

**Established patterns:**

- Cobra command with flags
- Lifecycle executor with GetSteps (from 12-01)
- fmt.Printf for user output
  </context>

<tasks>

<task type="auto">
  <name>Task 1: Add --dry-run flag to run command</name>
  <files>internal/cli/run.go</files>
  <action>
    Add `--dry-run` boolean flag to run command. When set:
    1. Create lifecycle executor as before
    2. Call executor.GetSteps(storyKey) instead of executor.Execute
    3. Print each step's workflow name in sequence
    4. Exit without executing anything

    Output format:
    ```
    Dry run for story STORY-KEY:
      1. create-story → ready-for-dev
      2. dev-story → review
      3. code-review → done
      4. git-commit → done
    ```

    Handle ErrStoryComplete: print "Story is already complete, no workflows to run"

  </action>
  <verify>go build ./cmd/bmad-automate && ./bmad-automate run --help | grep -q "dry-run"</verify>
  <done>--dry-run flag appears in help, command builds without errors</done>
</task>

<task type="auto">
  <name>Task 2: Add --dry-run flag to queue command</name>
  <files>internal/cli/queue.go</files>
  <action>
    Add `--dry-run` boolean flag to queue command. When set:
    1. For each story key in args, call executor.GetSteps
    2. Print steps grouped by story
    3. At end, print summary of total stories and workflows

    Output format:
    ```
    Dry run for 3 stories:

    Story 6-1-foo:
      1. dev-story → review
      2. code-review → done
      3. git-commit → done

    Story 6-2-bar:
      (already complete)

    Story 6-3-baz:
      1. create-story → ready-for-dev
      2. dev-story → review
      3. code-review → done
      4. git-commit → done

    Total: 7 workflows across 2 stories (1 already complete)
    ```

  </action>
  <verify>go build ./cmd/bmad-automate && ./bmad-automate queue --help | grep -q "dry-run"</verify>
  <done>--dry-run flag appears in queue help, output format matches spec</done>
</task>

<task type="auto">
  <name>Task 3: Add --dry-run flag to epic command</name>
  <files>internal/cli/epic.go</files>
  <action>
    Add `--dry-run` boolean flag to epic command. When set:
    1. Get epic stories via app.StatusReader.GetEpicStories
    2. For each story, call executor.GetSteps
    3. Print steps grouped by story (same format as queue)
    4. At end, print summary

    Output format matches queue command but header says "Dry run for epic X:"

  </action>
  <verify>go build ./cmd/bmad-automate && ./bmad-automate epic --help | grep -q "dry-run"</verify>
  <done>--dry-run flag appears in epic help, output format matches queue</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `go build ./cmd/bmad-automate` succeeds
- [ ] `go test ./...` passes
- [ ] All three commands show --dry-run in help
- [ ] `just lint` passes
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- --dry-run flag works for run, queue, and epic commands
- Output format is clear and shows workflow sequences
  </success_criteria>

<output>
After completion, create `.planning/phases/12-dry-run-mode/12-02-SUMMARY.md`:

# Phase 12 Plan 02: Dry Run Flags Summary

**[One-liner describing what was built]**

## Accomplishments

- Added --dry-run to run command
- Added --dry-run to queue command
- Added --dry-run to epic command

## Files Modified

- `internal/cli/run.go` - --dry-run flag and preview logic
- `internal/cli/queue.go` - --dry-run flag and preview logic
- `internal/cli/epic.go` - --dry-run flag and preview logic

## Decisions Made

[Any decisions about output format, etc.]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Phase Readiness

Phase 12 complete. Ready for Phase 13: Enhanced Progress UI.
</output>
